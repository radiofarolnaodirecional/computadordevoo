<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>

        *{margin: 0; padding: 0; box-sizing: border-box;}

        body{
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: black;
            overflow: hidden;
        }

        .compvoocalc{
            width: 700px;
            height: 700px;
            background-image: url(img/compcalc.svg);
            background-size: cover;
            position: relative;
            background-color: rgba(255, 0, 0, 0);
        }

        .compvoocalcfg{
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            background-image: url(img/compcalcfg.svg);
            background-size: cover;
            transition: 70ms;
            background-color: rgba(0, 128, 0, 0);
        }

        .compvoowind{
            width: 900px;
            height: 900px;
            background-image: url(img/compvoowind.svg);
            background-size: cover;
            position: relative;
            background-color: rgba(255, 255, 0, 0);
        }

        .compvoowindbg{
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            background-image: url(img/compvoowindbg.svg);
            background-size: cover;
            transition: 70ms ;
        }

        .compvoowindfg{
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            background-image: url(img/compvoowindfg.svg);
            background-size: cover;
            transform-origin: center center;
            transition: 70ms ;
            background-color: rgba(255, 0, 0, 0);
            pointer-events: none;
        }

        .drgb-updn{
            width: 67%;
            height: 67%;
            background-color: rgba(111, 0, 255, 0);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translateY(-50%) translateX(-50%);
            border-radius: 100%;
        }

        .rotate-dragb{
            width: 57%;
            height: 57%;
            background-color: rgba(255, 0, 0, 0);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translateY(-50%) translateX(-50%);
            border-radius: 100%;
            cursor: grab;
            pointer-events: auto;
        }

        .fg-markable{
            width: 45%;
            height: 45%;
            background-color: rgba(123, 255, 0, 0);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translateY(-50%) translateX(-50%);
            border-radius: 100%;
            pointer-events: auto;
            cursor: crosshair;
            backdrop-filter: blur(0.5px);
        }

        .point {
            width: 14px;
            height: 14px;
            background-color: rgba(39, 45, 155, 0.086);
            border-radius: 50%;
            position: absolute;
            transform: translate(-50%, -50%);
            background-image: url(img/point_x.svg);
            background-size: cover;
        }

        .compborder{
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            background-image: url(img/border.svg);
            background-size: cover;
            transition: 70ms ;
            background-color: rgba(255, 0, 0, 0);
            pointer-events: none;
            opacity: 0;
            transition: 200ms;
        }

        .compborder2{
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            background-image: url(img/border2.svg);
            background-size: cover;
            transition: 70ms ;
            background-color: rgba(255, 0, 0, 0);
            pointer-events: none;
            opacity: 0;
            transition: 200ms;
        }

    </style>
</head>
<body>

    <button style="margin: 1rem;" onclick="chancgeside()">change side</button>

    <div class="compvoocalc">
        <div class="compvoocalcfg rotatecalc"></div>
    </div>


    <div class="compvoowind" style="display: none;">
        <div class="compvoowindbg">

            <div class="compborder"></div>

            <div class="drgb-updn"></div>

            <div class="compvoowindfg rotate">
                <div class="rotate-dragb"></div>
                <div class="compborder2"></div>
                <div class="fg-markable"></div>
            </div>

        </div>
    </div>

    <!-- <input type="range" min="0" max="360" value="0" onchange="document.querySelector('.compvoowindfg').style.transform = 'rotate(' + this.value + 'deg)';">
    <input type="range" min="-400" max="400" value="0" onchange="document.querySelector('.compvoowindbg').style.transform = 'translateY(' + this.value + 'px)';"> -->


<script>
const rotate = (EL) => {
      let ang = 0; // Ângulo inicial em radianos
      let angStart = 0;
      let isStart = false;

      // Função que calcula o ângulo em relação ao centro do elemento
      const angXY = (ev) => {
        const bcr = EL.getBoundingClientRect();
        const radius = bcr.width / 2;
        const { clientX, clientY } = ev.touches ? ev.touches[0] : ev;
        const y = clientY - bcr.top - radius;  // Coordenada y a partir do centro
        const x = clientX - bcr.left - radius; // Coordenada x a partir do centro
        return Math.atan2(y, x);
      };

      // Função que inicia a rotação
      const startRotation = (ev) => {
        isStart = true;
        angStart = angXY(ev) - ang;
      };

      // Função que aplica a rotação durante o movimento
      const rotateElement = (ev) => {
        if (!isStart) return;
        ev.preventDefault();
        ang = angXY(ev) - angStart;
        EL.style.transform = `rotateZ(${ang}rad)`;
      };

      // Função que encerra a rotação
      const endRotation = () => {
        isStart = false; 
      };

      // Adiciona eventos de clique na área rotativa (rotate-dragb)
      const dragElement = EL.querySelector('.rotate-dragb');

      // Eventos de mouse para a rotação
      dragElement.addEventListener("mousedown", startRotation);
      document.addEventListener("mousemove", rotateElement);
      document.addEventListener("mouseup", endRotation);

      // Eventos de toque para dispositivos móveis
      dragElement.addEventListener("touchstart", startRotation);
      document.addEventListener("touchmove", rotateElement);
      document.addEventListener("touchend", endRotation);
    };

    // Aplica a função de rotação no elemento com classe 'rotate'
    document.querySelectorAll(".rotate").forEach(rotate);

///////////////////////////////

    const moveElementVertically = (draggable, movable) => {
    let startY, initialY, isDragging = false;

    const startDrag = (e) => {
        isDragging = true;
        startY = e.clientY || e.touches[0].clientY;
        const rect = movable.getBoundingClientRect();
        initialY = rect.top;
        draggable.style.cursor = 'grabbing';
    };

    const drag = (e) => {
        if (!isDragging) return;
        e.preventDefault();
        const currentY = e.clientY || e.touches[0].clientY;
        const dy = currentY - startY;
        movable.style.transform = `translateY(${initialY + dy}px)`;
    };

    const stopDrag = () => {
        isDragging = false;
        draggable.style.cursor = 'grab';
    };

    draggable.addEventListener('mousedown', startDrag);
    document.addEventListener('mousemove', drag);
    document.addEventListener('mouseup', stopDrag);

    draggable.addEventListener('touchstart', startDrag);
    document.addEventListener('touchmove', drag);
    document.addEventListener('touchend', stopDrag);
};

// Aplica a função de movimento vertical no .drgb-updn e .compvoowindbg
moveElementVertically(document.querySelector('.drgb-updn'), document.querySelector('.compvoowindbg'));








const drawingArea = document.querySelector('.fg-markable');

drawingArea.addEventListener('click', function(event) {
  // Remove o ponto anterior, se houver
  const existingPoint = drawingArea.querySelector('.point');
  if (existingPoint) {
    drawingArea.removeChild(existingPoint);
  }
  
  // Calcula a posição do clique relativa à div usando getBoundingClientRect
  const rect = drawingArea.getBoundingClientRect();
  const x = event.clientX - rect.left;
  const y = event.clientY - rect.top;
  
  // Cria um novo elemento de ponto
  const point = document.createElement('div');
  point.classList.add('point');
  
  // Define a posição do ponto
  point.style.left = `${x}px`;
  point.style.top = `${y}px`;

  // Adiciona o ponto na div
  drawingArea.appendChild(point);
});




// hover border
document.querySelector('.drgb-updn').addEventListener('mouseover', ()=> {
    document.querySelector('.compborder').style.opacity = '0.8'
})
document.querySelector('.drgb-updn').addEventListener('mouseout', ()=> {
    document.querySelector('.compborder').style.opacity = '0'
})

document.querySelector('.rotate-dragb').addEventListener('mouseover', ()=> {
    document.querySelector('.compborder2').style.opacity = '0.8'
})
document.querySelector('.rotate-dragb').addEventListener('mouseout', ()=> {
    document.querySelector('.compborder2').style.opacity = '0'
})











const rotatecalc = (EL) => {
  let ang = 0; // Ângulo inicial em radianos
  let angStart = 0;
  let isStart = false;

  // Função que calcula o ângulo em relação ao centro do elemento
  const angXY = (ev) => {
    const bcr = EL.getBoundingClientRect();
    const radius = bcr.width / 2;
    const { clientX, clientY } = ev.touches ? ev.touches[0] : ev;
    const y = clientY - bcr.top - radius;  // Coordenada y a partir do centro
    const x = clientX - bcr.left - radius; // Coordenada x a partir do centro
    return Math.atan2(y, x);
  };

  // Função que inicia a rotação
  const startRotation = (ev) => {
    isStart = true;
    angStart = angXY(ev) - ang;
  };

  // Função que aplica a rotação durante o movimento
  const rotateElement = (ev) => {
    if (!isStart) return;
    ev.preventDefault();
    ang = angXY(ev) - angStart;
    EL.style.transform = `rotateZ(${ang}rad)`;
  };

  // Função que encerra a rotação
  const endRotation = () => {
    isStart = false; 
  };

  // Eventos de mouse
  EL.addEventListener("mousedown", startRotation);
  document.addEventListener("mousemove", rotateElement);
  document.addEventListener("mouseup", endRotation);

  // Eventos de toque para dispositivos móveis
  EL.addEventListener("touchstart", startRotation);
  document.addEventListener("touchmove", rotateElement);
  document.addEventListener("touchend", endRotation);
};

// Seleciona todos os elementos com a classe 'rotate' e aplica a função de rotação
document.querySelectorAll(".rotatecalc").forEach(rotatecalc);



var chancgesidebl = true

function chancgeside(){

    if (chancgesidebl) {
        document.querySelector('.compvoocalc').style.display = 'none'
        document.querySelector('.compvoowind').style.display = 'block'
    }else{
        document.querySelector('.compvoocalc').style.display = 'block'
        document.querySelector('.compvoowind').style.display = 'none'
    }

    chancgesidebl = !chancgesidebl
}


</script>

</body>
</html>